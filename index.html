<!DOCTYPE html>
<html lang="th" data-theme="cmyk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-base-200">

    <div class="container mx-auto p-4 max-w-2xl">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-2xl mb-4">üìù ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2>

                <input type="hidden" id="timestamp" name="timestamp">
                <input type="hidden" id="jobNumber" name="jobNumber">
                <input type="hidden" id="lineUserID" name="lineUserID">
                <input type="hidden" id="lineDisplayName" name="lineDisplayName">
                <input type="hidden" id="lineProfilePicture" name="lineProfilePicture">
                <input type="hidden" id="status" name="status" value="New">

                <label class="form-control w-full">
                    <div class="label">
                        <span class="label-text">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</span>
                        <span class="label-text-alt">üë§</span>
                    </div>
                    <input type="text" id="reporterName" name="reporterName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" class="input input-bordered w-full" />
                </label>

                <label class="form-control w-full">
                    <div class="label">
                        <span class="label-text">‡∏™‡∏≤‡∏Ç‡∏≤</span>
                        <span class="label-text-alt">üè¢</span>
                    </div>
                    <select id="branch" name="branch" class="select select-bordered">
                        <option disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                        <option>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà</option>
                        <option>‡∏™‡∏≤‡∏Ç‡∏≤ A</option>
                        <option>‡∏™‡∏≤‡∏Ç‡∏≤ B</option>
                    </select>
                </label>

                <label class="form-control w-full">
                    <div class="label">
                        <span class="label-text">‡πÅ‡∏ú‡∏ô‡∏Å</span>
                        <span class="label-text-alt">üë•</span>
                    </div>
                    <select id="department" name="department" class="select select-bordered">
                        <option disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                        <option>IT</option>
                        <option>HR</option>
                        <option>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                        <option>‡∏ù‡πà‡∏≤‡∏¢‡∏ú‡∏•‡∏¥‡∏ï</option>
                    </select>
                </label>

                <label class="form-control w-full">
                    <div class="label">
                        <span class="label-text">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤</span>
                        <span class="label-text-alt">‚öôÔ∏è</span>
                    </div>
                    <select id="issueType" name="issueType" class="select select-bordered">
                        <option disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤</option>
                        <option>‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå / ‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ</option>
                        <option>‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                        <option>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ / Wi-Fi</option>
                        <option>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° / ‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå</option>
                        <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </label>

                <label class="form-control w-full">
                    <div class="label">
                        <span class="label-text">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</span>
                        <span class="label-text-alt">‚úçÔ∏è</span>
                    </div>
                    <textarea id="description" name="description" class="textarea textarea-bordered h-24" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÄ‡∏à‡∏≠‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
                </label>
                
                <label class="form-control w-full">
                    <div class="label">
                        <span class="label-text">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</span>
                        <span class="label-text-alt">üî•</span>
                    </div>
                    <select id="urgency" name="urgency" class="select select-bordered">
                         <option disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</option>
                        <option>‡∏ï‡πà‡∏≥ (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</option>
                        <option>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)</option>
                        <option>‡∏™‡∏π‡∏á (‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)</option>
                    </select>
                </label>

                <label class="form-control w-full">
                    <div class="label">
                        <span class="label-text">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                        <span class="label-text-alt">üñºÔ∏è</span>
                    </div>
                    <input type="file" id="imageURL" name="imageURL" class="file-input file-input-bordered w-full" />
                </label>


                <div class="card-actions justify-end mt-6">
                    <button class="btn btn-primary w-full">‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 1. Initialize LIFF
        liff.init({ liffId: "2007374280-GEYwyNdl" }) // << ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            .then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå LINE
                    liff.getProfile()
                        .then(profile => {
                            document.getElementById('lineUserID').value = profile.userId;
                            document.getElementById('lineDisplayName').value = profile.displayName;
                            document.getElementById('lineProfilePicture').value = profile.pictureUrl;
                            // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠ LINE ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ
                            document.getElementById('reporterName').value = profile.displayName;
                        })
                        .catch(err => console.error(err));
                }
            })
            .catch(err => console.error(err));

        // 3. ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
        const form = document.querySelector('.card-body');
        form.addEventListener('submit', function (event) {
            event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤
            
            // 4. ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
            const formData = {
                lineUserID: document.getElementById('lineUserID').value,
                lineDisplayName: document.getElementById('lineDisplayName').value,
                lineProfilePicture: document.getElementById('lineProfilePicture').value,
                reporterName: document.getElementById('reporterName').value,
                branch: document.getElementById('branch').value,
                department: document.getElementById('department').value,
                issueType: document.getElementById('issueType').value,
                description: document.getElementById('description').value,
                urgency: document.getElementById('urgency').value,
                // ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å
                // ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
                imageURL: "" 
            };

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!formData.reporterName || formData.branch === '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤' || !formData.description) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô: ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á, ‡∏™‡∏≤‡∏Ç‡∏≤, ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤');
                return;
            }

            // 5. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á n8n Webhook
            const webhookUrl = 'YOUR_N8N_WEBHOOK_PRODUCTION_URL'; // << ‡πÉ‡∏™‡πà URL ‡∏à‡∏≤‡∏Å n8n
            
            fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => {
                if (response.ok) {
                    alert('‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    // ‡∏õ‡∏¥‡∏î LIFF App ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    liff.closeWindow();
                } else {
                    throw new Error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            });
        });
    });
</script>
